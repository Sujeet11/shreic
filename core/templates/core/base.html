<!DOCTYPE html>
<html>
<head>
    <title>Shreic</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
        <a class="navbar-brand" href="/">Shreic</a>

        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                {% if user.is_authenticated %}
                    <li class="nav-item"><a class="nav-link" href="#">Hi, {{ user.username }}</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'upload_book' %}">Upload Book</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'request_book' %}">📄 Request Book</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'list_book_requests' %}">📚 Requested Books</a></li>

                    <li class="nav-item"><a class="nav-link" href="{% url 'upload_notes' %}">Upload Notes</a></li>
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'order_history' %}">📦 Orders</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'chat_inbox' %}">💬 My Chats</a></li>
                    <li class="nav-item">
                      <a class="nav-link" href="#">
                        🔔 Notifications
                        {% if unread_count > 0 %}
                          <span class="badge bg-danger">{{ unread_count }}</span>
                        {% endif %}
                      </a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'user_list' %}">Messages</a></li>

                    <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
                {% else %}
                    <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">Sign Up</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
                {% endif %}
            </ul>

            <form class="d-flex position-relative w-100" role="search" onsubmit="return false;">
              <input class="form-control me-2" type="search" id="searchInput" placeholder="Search..." aria-label="Search">
              <div id="searchResults" class="bg-light p-3 rounded shadow-sm w-100"
                style="position: absolute; top: 100%; left: 0; z-index: 1000;"></div>
            </form>
        </div>
    </nav>

    <div class="container mt-4">
        {% block content %}
        {% endblock %}
    </div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('searchInput');
    const resultsDiv = document.getElementById('searchResults');

    searchInput.addEventListener('input', function () {
      const query = this.value;

      if (query.length > 1) {
        fetch(`/search/?q=${query}`)
          .then(response => response.json())
          .then(data => {
            let html = '';

            if (data.books.length === 0 && data.notes.length === 0) {
              html = '<p class="text-muted">No results found.</p>';
            }

            if (data.books.length > 0) {
              html += '<strong>📚 Books:</strong><ul class="list-group mb-2">';
              data.books.forEach(book => {
                html += `<li class="list-group-item">${book.title} by ${book.author || 'Unknown'}</li>`;
              });
              html += '</ul>';
            }

            if (data.notes.length > 0) {
              html += '<strong>📝 Notes:</strong><ul class="list-group">';
              data.notes.forEach(note => {
                html += `<li class="list-group-item">${note.title} (${note.publication || 'N/A'})</li>`;
              });
              html += '</ul>';
            }

            resultsDiv.innerHTML = html;
          });
      } else {
        resultsDiv.innerHTML = ''; // clear results if input too short
      }
    });

    // Optional: hide results when clicking outside
    document.addEventListener('click', function (e) {
      if (!searchInput.contains(e.target) && !resultsDiv.contains(e.target)) {
        resultsDiv.innerHTML = '';
      }
    });
  });
</script>
</body>
</html>
